<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Ryberg Shooter</title>
    <style>
        body { margin: 0; background: #222; color: white; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; background: #000; }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 5; font-size: 20px; color: #0f0; }
        #start {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 30px; border: 2px solid #0f0; text-align: center;
        }
        button { background: #0f0; border: none; padding: 10px 20px; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="ui">SCORE: <span id="s">0</span> | LIVES: <span id="l">3</span></div>
    
    <div id="start">
        <h1>RYBERG ATTACK</h1>
        <p>WASD för att flytta - Mus för att skjuta</p>
        <button id="go">STARTA SPELET</button>
    </div>

    <canvas id="c"></canvas>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        const startDiv = document.getElementById('start');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // BILDHANTERING
        const img = new Image();
        img.src = 'ryberg.jpg';
        img.onerror = () => console.log("Kunde inte hitta ryberg.jpg");

        let score = 0, lives = 3, active = false;
        let p = { x: canvas.width/2, y: canvas.height-100, w: 40, h: 40 };
        let bullets = [], enemies = [], keys = {};

        // KONTROLLER
        window.onkeydown = e => keys[e.code] = true;
        window.onkeyup = e => keys[e.code] = false;
        window.onmousedown = () => { if(active) bullets.push({x: p.x + 18, y: p.y, w: 4, h: 10}); };

        document.getElementById('go').onclick = () => {
            startDiv.style.display = 'none';
            active = true;
            loop();
        };

        function loop() {
            if(!active) return;
            update();
            draw();
            requestAnimationFrame(loop);
        }

        function update() {
            // WASD Movement
            if(keys['KeyW'] && p.y > 0) p.y -= 7;
            if(keys['KeyS'] && p.y < canvas.height - p.h) p.y += 7;
            if(keys['KeyA'] && p.x > 0) p.x -= 7;
            if(keys['KeyD'] && p.x < canvas.width - p.w) p.x += 7;

            // Bullets
            bullets.forEach((b, i) => {
                b.y -= 10;
                if(b.y < 0) bullets.splice(i, 1);
            });

            // Enemies (Spawn din vän)
            if(Math.random() < 0.03) {
                enemies.push({ x: Math.random()*(canvas.width-60), y: -80, w: 60, h: 80, speed: 3 + (score/200) });
            }

            enemies.forEach((e, i) => {
                e.y += e.speed;
                
                // Kollision med spelare
                if(e.x < p.x + p.w && e.x + e.w > p.x && e.y < p.y + p.h && e.y + e.h > p.y) {
                    enemies.splice(i, 1);
                    lives--;
                    document.getElementById('l').innerText = lives;
                    if(lives <= 0) location.reload();
                }

                // Kollision med skott
                bullets.forEach((b, bi) => {
                    if(b.x < e.x + e.w && b.x + b.w > e.x && b.y < e.y + e.h && b.y + b.h > e.y) {
                        enemies.splice(i, 1);
                        bullets.splice(bi, 1);
                        score += 10;
                        document.getElementById('s').innerText = score;
                    }
                });

                if(e.y > canvas.height) enemies.splice(i, 1);
            });
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Spelare
            ctx.fillStyle = '#0f0';
            ctx.fillRect(p.x, p.y, p.w, p.h);

            // Skott
            ctx.fillStyle = '#ff0';
            bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

            // Rita din vän
            enemies.forEach(e => {
                if(img.complete && img.naturalWidth !== 0) {
                    ctx.drawImage(img, e.x, e.y, e.w, e.h);
                } else {
                    ctx.fillStyle = 'red';
                    ctx.fillRect(e.x, e.y, e.w, e.h);
                }
            });
        }
    </script>
</body>
</html>
