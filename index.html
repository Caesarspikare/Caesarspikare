<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ryberg Survival - Färgglada fiender</title>
<style>
body {
    text-align: center;
    background-color: #111;
    color: #fff;
    font-family: Arial, sans-serif;
}

canvas {
    background-color: #222;
    border-radius: 15px;
    border: 3px solid #fff;
    display: block;
    margin: 20px auto;
}

#hud {
    margin-top: 10px;
    font-size: 20px;
    display: flex;
    justify-content: center;
    gap: 30px;
    font-weight: bold;
}
</style>
</head>
<body>
<h1>Ryberg Survival</h1>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="hud">
    <span id="score">Score: 0</span>
    <span id="time">Tid: 0s</span>
    <span id="lives">Liv: 3</span>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Spelare
const player = {
    x: canvas.width/2,
    y: canvas.height/2,
    radius: 20,
    speed: 5,
    color: 'green',
    lives: 3,
    bullets: []
};

// Ljud (lägg mp3-filer i samma mapp)
const shootSound = new Audio('shoot.mp3');
const hitSound = new Audio('hit.mp3');
const powerupSound = new Audio('powerup.mp3');
const gameOverSound = new Audio('gameover.mp3');

// Fiender och powerups
let enemies = [];
let powerups = [];
let score = 0;
let elapsedTime = 0;
let lastEnemySpawn = 0;
let lastPowerupSpawn = 0;
let gameOver = false;

let keys = {};

document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);
canvas.addEventListener('click', shootBullet);

// Skott
function shootBullet(e){
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;
    const angle = Math.atan2(mouseY - player.y, mouseX - player.x);
    player.bullets.push({x: player.x, y: player.y, angle, speed: 10});
    shootSound.currentTime = 0;
    shootSound.play();
}

// Spawn fiender
function spawnEnemy(){
    const side = Math.random() < 0.5 ? 'left' : 'right';
    const x = side === 'left' ? 0 : canvas.width;
    const y = Math.random()*canvas.height;
    const size = Math.random()*15 + 15; // mindre fiender
    const colors = ['red', 'orange', 'purple', 'blue']; // olika färger
    const color = colors[Math.floor(Math.random()*colors.length)];
    enemies.push({x, y, radius: size, speed: 2 + Math.random()*2, color});
}

// Spawn powerup
function spawnPowerup(){
    const x = Math.random()*(canvas.width-20)+10;
    const y = Math.random()*(canvas.height-20)+10;
    powerups.push({x, y, radius: 10, type:'heal'});
}

// Reset game
function resetGame(){
    player.lives = 3;
    score = 0;
    elapsedTime = 0;
    enemies = [];
    powerups = [];
    player.x = canvas.width/2;
    player.y = canvas.height/2;
    gameOver = false;
    gameOverSound.play();
}

// Update
function update(deltaTime){
    if(gameOver) return;

    elapsedTime += deltaTime/1000;

    // Rörelse
    if(keys['w'] || keys['ArrowUp']) player.y -= player.speed;
    if(keys['s'] || keys['ArrowDown']) player.y += player.speed;
    if(keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
    if(keys['d'] || keys['ArrowRight']) player.x += player.speed;

    player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
    player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));

    // Skott
    player.bullets.forEach((b,i)=>{
        b.x += Math.cos(b.angle)*b.speed;
        b.y += Math.sin(b.angle)*b.speed;
        if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) player.bullets.splice(i,1);
    });

    // Fiender
    enemies.forEach((e,i)=>{
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx,dy);
        e.x += (dx/dist)*e.speed;
        e.y += (dy/dist)*e.speed;

        // Skott träff
        player.bullets.forEach((b,j)=>{
            const d = Math.hypot(b.x-e.x, b.y-e.y);
            if(d < e.radius){
                enemies.splice(i,1);
                player.bullets.splice(j,1);
                score += 10;
                hitSound.currentTime = 0;
                hitSound.play();
            }
        });

        // Koll med spelare
        const distPlayer = Math.hypot(player.x-e.x, player.y-e.y);
        if(distPlayer < e.radius + player.radius){
            enemies.splice(i,1);
            player.lives -=1;
            if(player.lives<=0){
                gameOver = true;
                resetGame();
            }
        }
    });

    // Powerups
    powerups.forEach((p,i)=>{
        const d = Math.hypot(player.x - p.x, player.y - p.y);
        if(d < player.radius + p.radius){
            powerups.splice(i,1);
            player.lives = Math.min(player.lives+1,5);
            powerupSound.currentTime = 0;
            powerupSound.play();
        }
    });

    // Spawna fiender/powerups
    if(Date.now() - lastEnemySpawn > 2000){
        spawnEnemy();
        lastEnemySpawn = Date.now();
    }
    if(Date.now() - lastPowerupSpawn > 8000){
        spawnPowerup();
        lastPowerupSpawn = Date.now();
    }

    // HUD
    document.getElementById('score').textContent = "Score: "+score;
    document.getElementById('time').textContent = "Tid: "+Math.floor(elapsedTime)+"s";
    document.getElementById('lives').textContent = "Liv: "+player.lives;
}

// Draw
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Spelare
    ctx.fillStyle = player.color;
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
    ctx.fill();

    // Skott
    ctx.fillStyle='yellow';
    player.bullets.forEach(b=>{
        ctx.beginPath();
        ctx.arc(b.x, b.y, 5, 0, Math.PI*2);
        ctx.fill();
    });

    // Fiender
    enemies.forEach(e=>{
        ctx.fillStyle = e.color;
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.radius, 0, Math.PI*2);
        ctx.fill();
    });

    // Powerups
    powerups.forEach(p=>{
        ctx.fillStyle='magenta';
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
        ctx.fill();
    });
}

let lastTime = 0;
function gameLoop(timestamp){
    const deltaTime = timestamp - lastTime;
    lastTime = timestamp;
    update(deltaTime);
    draw();
    requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
</script>
</body>
</html>
